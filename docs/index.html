<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programming Skills Benchmarks</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .code-container {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
        }
        .rating-badge {
            font-size: 0.9em;
            padding: 4px 8px;
        }
        .judgment-box {
            background-color: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 12px;
            margin-bottom: 16px;
        }
        .code-comparison {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 16px;
            margin-top: 16px;
        }
        .code-section {
            margin-bottom: 16px;
        }
        .code-section h7 {
            color: #6c757d;
            margin-bottom: 8px;
        }
        pre {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 12px;
            overflow-x: auto;
        }
        #detailModal .modal-dialog {
            max-width: 90%;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
                Programming Skills Benchmarks
            </span>
            <button class="btn btn-sm btn-outline-light" onclick="refreshData()">Refresh</button>
        </div>
    </nav>

    <!-- Summary Cards -->
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Total Benchmarks</h5>
                        <h2 class="card-text">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Skills Tested</h5>
                        <h2 class="card-text">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Improvements</h5>
                        <h2 class="card-text text-success">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Improvement Rate</h5>
                        <h2 class="card-text">0%</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="container mt-4">
        <div class="row g-2 align-items-end">
            <div class="col-md-3">
                <label class="form-label fw-bold">Provider</label>
                <select class="form-select" id="filter-provider" onchange="filterTable()">
                    <option value="">All Providers</option>
                    
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold">Model</label>
                <select class="form-select" id="filter-model" onchange="filterTable()">
                    <option value="">All Models</option>
                    
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold">Skill</label>
                <select class="form-select" id="filter-skill" onchange="filterTable()">
                    <option value="">All Skills</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold">Improvement</label>
                <select class="form-select" id="filter-improvement" onchange="filterTable()">
                    <option value="">All</option>
                    <option value="yes">Improvement</option>
                    <option value="no">Regression</option>
                    <option value="neutral">Neutral</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Skills Table -->
    <div class="container mt-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Benchmark Results</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0" id="skills-table">
                        <thead class="table-light">
                            <tr>
                                <th>Skill</th>
                                <th>Provider</th>
                                <th>Model</th>
                                <th>Before</th>
                                <th>After</th>
                                <th>Improvement</th>
                                <th>View Details</th>
                            </tr>
                        </thead>
                        <tbody id="skills-table-body">
                            
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Details -->
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="detailModalTitle">Skill Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="modal-content">
                        <!-- Populated by JS -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS -->
    <script>
        // Data loaded from external JSON
        let allData = {
  "benchmarks": [],
  "summary": {}
};

        function getRatingColor(rating) {
            const colors = {
                'vague': 'secondary',
                'regular': 'warning',
                'good': 'primary',
                'outstanding': 'success'
            };
            return colors[rating] || 'secondary';
        }

        function getImprovementColor(improvement) {
            const colors = {
                'yes': 'success',
                'no': 'danger',
                'neutral': 'secondary'
            };
            return colors[improvement] || 'secondary';
        }

        function escapeHtml(text) {
            if (!text) return '';
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        function formatReasoning(reasoning) {
            return reasoning.replace(/\n/g, '<br>');
        }

        function showDetails(skill) {
            const modalTitle = document.getElementById('detailModalTitle');
            const modalContent = document.getElementById('modal-content');

            modalTitle.textContent = `Details: ${
                skill.skill_name || 'Unknown Skill'
            }`;

            const judgment = skill.judgment || {
                'option_a_rating': 'vague',
                'option_b_rating': 'vague',
                'overall_better': 'Equal',
                'reasoning': 'No judgment available'
            };

            const judgmentBox = `<div class="judgment-box">
                <h6>Judge Assessment</h6>
                <p><strong>Before (Baseline):</strong> ${
                    judgment.option_a_rating || 'vague'
                }</p>
                <p><strong>After (With Skill):</strong> ${
                    judgment.option_b_rating || 'vague'
                }</p>
                <p><strong>Overall Better:</strong> ${
                    judgment.overall_better || 'Equal'
                }</p>
                <hr>
                <p><strong>Reasoning:</strong></p>
                <div>${
                    formatReasoning(skill.reasoning || 'No reasoning')
                }</div>
            </div>`;

            const codeComparison = `<div class="code-comparison">
                <div class="row">
                    <div class="col-md-6">
                        <div class="code-section">
                            <h7>Before (Baseline)</h7>
                            <div class="code-container">
                                <pre><code>${
                                    escapeHtml(skill.before_code || '// No code generated')
                                }</code></pre>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="code-section">
                            <h7>After (With Skill)</h7>
                            <div class="code-container">
                                <pre><code>${
                                    escapeHtml(skill.after_code || '// No code generated')
                                }</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;

            modalContent.innerHTML = judgmentBox + codeComparison;

            const modal = new bootstrap.Modal(document.getElementById('detailModal'));
            modal.show();
        }

        function filterTable() {
            const provider = document.getElementById('filter-provider').value.toLowerCase();
            const model = document.getElementById('filter-model').value.toLowerCase();
            const skill = document.getElementById('filter-skill').value.toLowerCase();
            const improvement = document.getElementById('filter-improvement').value.toLowerCase();

            const rows = document.querySelectorAll('#skills-table-body tr');
            let visibleCount = 0;

            rows.forEach(row => {
                const cells = row.cells;
                const rowProvider = cells[1].textContent.toLowerCase();
                const rowModel = cells[2].textContent.toLowerCase();
                const rowSkill = cells[0].textContent.toLowerCase();
                const rowImprovement = cells[5].textContent.toLowerCase();

                const matchProvider = !provider || rowProvider.includes(provider);
                const matchModel = !model || rowModel.includes(model);
                const matchSkill = !skill || rowSkill.includes(skill);
                const matchImprovement = !improvement || rowImprovement.includes(improvement);

                if (matchProvider && matchModel && matchSkill && matchImprovement) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });

            console.log(`Showing ${
                visibleCount
            } skills`);
        }

        function refreshData() {
            // Reload the page to get fresh data
            window.location.reload();
        }

        // Initial table render
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Benchmarks loaded:', allData.benchmarks.length, 'benchmarks');
            console.log('Total skills:', allData.summary.total_skills);
        });
    </script>
</body>
</html>